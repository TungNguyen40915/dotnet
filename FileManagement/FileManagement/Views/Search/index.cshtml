@model sharedfile.Models.SearchVM
@{
    ViewBag.Title = "Search File";
}

<link href="~/css/style.css" rel="stylesheet" />
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript">
        var numPerPage = @ViewBag.MaxItems;
        var totalRecords = @ViewBag.totalRecords;
        var currentPage = @ViewBag.currentPage;
        var pageCount = @ViewBag.pageCount;
        var maxLengthSearchFileName = @ViewBag.maxLengthSearchFileName;
        var maxLengthSearchKeyword = @ViewBag.maxLengthSearchKeyword;
</script>
<!-- container -->
<div class="container">
    <div class="gpp20-section">
        <!--Start Form Search-->
        <form asp-controller="Search" asp-action="Search" method="get" enctype="multipart/form-data" id="searchViewModel">
            <div asp-validation-summary="All" class="text-danger"></div>
            <div class="gpp20-inputgroup">
                <p class="input-label">File Name</p>
                <input name="fileName" id="fileName" value="@ViewBag.fileName" onchange="checkAllEmpty()" class="gpp20-search-form gpp_w66p" placeholder="Enter file name ..." aria-label="Enter file name ...">
            </div>
            <div class="gpp20-inputgroup gpp20-datepicker">
                <p class="input-label">ファイルアップロード日時</p>
                <div class="datepicker gpp_w66p">
                    <input id="uploadDateFrom" name="uploadDateFrom" onchange="checkAllEmpty()" value="@ViewBag.uploadDateFrom" type="text" aria-label="開始日付"><span>～</span>
                    <input id="uploadDateTo" name="uploadDateTo" onchange="checkAllEmpty()" value="@ViewBag.uploadDateTo" type="text" aria-label="終了日付">
                </div>
            </div>
            <div class="gpp20-inputgroup">
                <p class="input-label">キーワードを設定して表示する</p>
                <input name="keyWord" id="keyWord" value="@ViewBag.keyWord" onchange="checkAllEmpty()" class="gpp20-search-form gpp_w66p" placeholder="検索する文章を入力" aria-label="検索する文章を入力">
            </div>
            <input name="uid" id="uid" value="@ViewBag.uid" type="hidden">
            <input name="at" id="at" value="@ViewBag.at" type="hidden">
            <input name="currentPage" id="currentPage" value="@ViewBag.currentPage" type="hidden">
            <div class="gpp_tac gpp_mt-24">
                <a disable class="gpp_button gpp_btn-secondry icon-ico_search disabled" onclick="submitForm()" id="btnSearch" href="javascript:void(0);">表示する</a>
            </div>
        </form>
        <!--End Form Search-->
        @if (Model != null && Model.files != null && Model.files.Count() > 0)
        {
            <div class="gpp20-searchresult-utility gpp_mt-32">
                <div class="records">
                    <p> <span>@Model.totalRecords</span>件が該当しました</p>
                </div>
            </div>
            <table class="table_data gpp20_searchresult-table">
                <thead>
                    <tr>
                        <th>ファイル名</th>
                        <th class="result-filesize">ファイルサイズ</th>
                        <th class="result-day">アップロード日時    </th>
                    </tr>
                </thead>
                <tbody id="pagination">
                    @foreach (var item in Model.files)
                    {
                        <tr class="row-item">
                            <td>
                                <p class="result-filename"><a class="result-filelink" value="@item.FileName" href="/Download/index?uid=@ViewBag.uid&at=@ViewBag.at&fiid=@item.GUID">@Html.DisplayFor(modelItem => item.FileName)</a></p>
                                <p class="result-filepass">
                                    <script language="javascript">
                                            document.write(window.location.origin+"/Download/index?uid=@ViewBag.uid&at=@ViewBag.at&fiid=@item.GUID");
                                    </script>
                                </p>
                            </td>
                            <td class="result-filesize">@((item.FileSize /1024).ToString("0.00"))KB</td>
                            <td class="result-day">@Convert.ToDateTime(item.UploadedDate).ToString("yyyy/MM/dd HH:mm")</td>
                        </tr>
                    }
                </tbody>
            </table>
            <div class="gpp20-pagination">
                <ul class="pagination pagination-sm custom-pagination">
                </ul>
            </div>
        }
        else if (Model != null)
        {
            <div class="gpp20-searchresult-utility gpp_mt-32"></div>
            <p class="input-label">ご入力条件での結果が見つかりません。</p>
            <div class="gpp20-searchresult-utility gpp_mt-32"></div>
        }
        else
        {
            <div class="gpp20-searchresult-utility gpp_mt-32"></div>
        }
        <form asp-controller="Search" asp-action="Search" method="get" enctype="multipart/form-data" id="paging-search">
            <input id="fileNameVB" value="@ViewBag.fileName" type="hidden">
            <input id="uploadDateFromVB" value="@ViewBag.uploadDateFrom" type="hidden">
            <input id="uploadDateToVB" value="@ViewBag.uploadDateTo" type="hidden">
            <input id="keyWordVB" value="@ViewBag.keyWord" type="hidden">
            <input id="uidVB" value="@ViewBag.uid" type="hidden">
            <input id="atVB" value="@ViewBag.at" type="hidden">
            <input id="currentPageVB" value="@ViewBag.currentPage" type="hidden">
        </form>
    </div>
</div>
<div class="modal" tabindex="-1" role="dialog" id="form-modal-message">
    <div class="vertical-alignment-helper">
        <div class="modal-dialog vertical-align-center">
            <div class="modal-content">
                <div style="text-align: center" class="modal-header">
                    <h5 class="modal-title">エラー</h5>
                </div>
                <div style="text-align: center" class="modal-body">

                </div>
                <div style="text-align: right" class="modal-footer">
                    <button type="button" class="close-button" onclick="resetModal()">閉じる </button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="~/lib/jquery/dist/jquery-3.5.1.min.js"></script>
<script src="~/lib/jquery/dist/jquery-ui.js"></script>
<script src="~/lib/jquery/dist/script.js"></script>
<script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>
<script src="~/js/search.js"></script>
<script src="~/js/paging.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>
<script src="~/lib/jquery/dist/pagination.js"></script>

